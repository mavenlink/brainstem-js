<!DOCTYPE html>
<html>
  <head>
  <meta charset='UTF-8'>
  <title>CoffeeScript API Documentation</title>
  <script src='../javascript/application.js'></script>
  <script src='../javascript/search.js'></script>
  <link rel='stylesheet' href='../stylesheets/application.css' type='text/css'>
</head>
  <body>
    <div id='base' data-path='../'></div>
<div id='header'>
  <div id='menu'>
    <a href='../extra/README.md.html' title='Brainstem-js'>
      Brainstem-js
    </a>
    &raquo;
    <a href='../alphabetical_index.html' title='Index'>
      Index
    </a>
    &raquo;
    <span class='title'>README.md</span>
  </div>
</div>
    <div id='content'>
      <nav class='toc'>
        <p class='title'>
          <a class='hide_toc' href='#'>
            <strong>Table of Contents</strong>
          </a>
          <small>
            (<a class='float_toc' href='#'>left</a>)
          </small>
        </p>
      </nav>
      <div id='filecontents'>
        <h1 id="brainstem-js">Brainstem.js</h1><p><a href="https://travis-ci.org/mavenlink/brainstem-js"><img src="https://travis-ci.org/mavenlink/brainstem-js.png" alt="Build Status"></a></p><p><a href="https://github.com/mavenlink/brainstem">Brainstem</a> is designed to power rich APIs in Rails. The Brainstem gem provides a presenter library that handles converting ActiveRecord objects into structured JSON and a set of API abstractions that allow users to request sorts, filters, and association loads, allowing for simpler implementations, fewer requests, and smaller responses.</p><p>The Brainstem.js library is a companion library for Backbone.js that makes integration with Brainstem APIs a breeze.  Brainstem.js adds an identity map and relational models to Backbone.</p><h2 id="why-brainstem-js-">Why Brainstem.js?</h2>
<ul>
<li>Speaks natively to Brainstem APIs</li>
<li>Adds relational models in Backbone, allowing you to setup has_one, has_many, and belongs_to relationships.</li>
<li>Provides an Identity Map to avoid loading already-available records.</li>
<li>Supports Brainstem side-loading of multiple objects for fast, single-request workflows.</li>
<li>Interprets the Brainstem results array and hashes for you, abstracting away the JSON protocol.</li>
<li>Written in CoffeeScript.</li>
</ul>
<h2 id="usage">Usage</h2><p>If you&#39;re in Rails, just add <code>brainstem-js</code> to your Gemfile and require <code>brainstem</code> in <code>application.js</code>.</p><p>We have a <a href="https://github.com/mavenlink/brainstem-demo-rails">comprehensive demo available</a>.  We recommend that you start there.</p><p>What follows is an overview.</p><h3 id="storagemanager">StorageManager</h3><p>The <code>Brainstem.StorageManager</code> is in charge of loading data over the API, as well as returning already cached data.  We recommend setting one up in a singleton App class.</p><pre><code>class Application
  constructor: -&gt;
    @data = new Brainstem.StorageManager()
    @data.addCollection &#39;widgets&#39;, Collections.Widgets
    @data.addCollection &#39;locations&#39;, Collections.Locations
    @data.addCollection &#39;features&#39;, Collections.Features
    @homeRouter = new Routers.WidgetsRouter()

$ -&gt;
  window.base = new Application()
  Backbone.history.start(root: &quot;/&quot;)
</code></pre><p>At the moment, the global StorageManager <em>must</em> be available at <code>window.base.data</code>.  For this reason, we recommend making a singleton instance of an <code>Application</code> class for holding your <code>StorageManager</code> and any other shared resources.</p><h3 id="brainstem-models-and-brainstem-collections">Brainstem.Models and Brainstem.Collections</h3><p>Once you have a StorageManager, you should setup some <code>Brainstem.Models</code> and <code>Brainstem.Collections</code>:</p><pre><code>window.Models ?= {}
window.Collections ?= {}

class Models.Widget extends Brainstem.Model
  paramRoot: &#39;widget&#39;
  brainstemKey: &#39;widgets&#39;
  urlRoot: &#39;/api/v1/widgets&#39;

  @associations:
    features: [&quot;features&quot;] # Has many
    location: &quot;locations&quot; # Belongs to
    parent: [&quot;sprocket&quot;, &quot;widget&quot;] # Belongs to (polymorphic)

class Collections.Widgets extends Brainstem.Collection
  model: Models.Widget
  url: &#39;/api/v1/widgets&#39;

class Models.Feature extends Brainstem.Model
  paramRoot: &#39;feature&#39;
  brainstemKey: &#39;features&#39;
  urlRoot: &#39;/api/v1/features&#39;

  @associations:
    widgets: [&quot;widgets&quot;]

class Collections.Features extends Brainstem.Collection
  model: Models.Feature
  url: &#39;/api/v1/features&#39;
</code></pre><p>Use the <code>@associations</code> class method to declare the mapping between association names and <code>StorageManager</code> collections where the data can be located.  Arrays indicate has_many relationships.  Other than a few additions, these are just Backbone Models and Collections.</p><h3 id="backbone-views">Backbone.Views</h3><p>Now that you have models, collections, and a <code>StorageManager</code>, it&#39;s time to load some data (probably in Backbone.Views).  For example:</p><pre><code>class Views.Widgets.IndexView extends Backbone.View
  template: JST[&quot;backbone/templates/widgets/index&quot;]

  initialize: -&gt;
    @collection = base.data.loadCollection &quot;widgets&quot;, include: [&quot;location&quot;, &quot;features&quot;], order: &#39;updated_at:desc&#39;
    @collection.bind &#39;reset&#39;, @addAll
    @collection.bind &#39;remove&#39;, @addAll

  render: =&gt;
    @$el.html @template()

    if @collection.loaded
      @addAll()
    else
      @$(&quot;#widgets-list&quot;).text &quot;Just a moment...&quot;

    return this

  addAll: =&gt;
    @$(&quot;#widgets-list&quot;).empty()
    @collection.each(@addOne)
    @addLocations()

  addOne: (model) =&gt;
    view = new Views.Widgets.WidgetView(model: model)
    @$(&quot;#widgets-list&quot;).append view.render().el
</code></pre><p>And finally, in your templates, you can access the relational data just like you&#39;d normally access model data in Backbone.</p><pre><code>@model.get(&#39;location&#39;).get(&#39;name&#39;)

for feature in @model.get(&#39;features&#39;).models:
</code></pre><p>Etc.</p><h2 id="development">Development</h2><p>We&#39;re always open to pull requests!</p><h3 id="dependencies">Dependencies</h3>
<ul>
<li>PhantomJS. If you&#39;re on OS X, run <code>brew install phantomjs</code>.</li>
</ul>
<h3 id="running-specs">Running Specs</h3><p>To run the specs on the command line, run:</p><pre><code>bundle exec rake
</code></pre><p>To run the specs in a server with live code reloading and compilation:</p><pre><code>bundle exec rake server
</code></pre><p>To develop your application against a local checkout of brainstem-js, we suggest using Bundler&#39;s local gems:</p><pre><code>bundle config local.brainstem-js ~/workspace/brainstem-js
</code></pre><p>And when you&#39;re done, run:</p><pre><code>bundle config --delete local.brainstem-js
</code></pre><h3 id="building-docs">Building Docs</h3><p>To build the documentation, run the following from the root directory:</p><pre><code>    codo
</code></pre><h1 id="license">License</h1><p>Brainstem and Brainstem.js were created by Mavenlink, Inc. and are available under the MIT License.</p>
      </div>
    </div>
    <div id='footer'>
  November 17, 14 15:24:45 by
  <a href='https://github.com/coffeedoc/codo' title='CoffeeScript API documentation generator'>
    Codo
  </a>
  2.0.9
  &#10034;
  Press H to see the keyboard shortcuts
  &#10034;
  <a href='http://twitter.com/netzpirat' target='_parent'>@netzpirat</a>
  &#10034;
  <a href='http://twitter.com/_inossidabile' target='_parent'>@_inossidabile</a>
</div>
<iframe id='search_frame'></iframe>
<div id='fuzzySearch'>
  <input type='text'>
  <ol></ol>
</div>
<div id='help'>
  <p>
    Quickly fuzzy find classes, mixins, methods, file:
  </p>
  <ul>
    <li>
      <span>T</span>
      Open fuzzy finder dialog
    </li>
  </ul>
  <p>
    Control the navigation frame:
  </p>
  <ul>
    <li>
      <span>L</span>
      Toggle list view
    </li>
    <li>
      <span>C</span>
      Show class list
    </li>
    <li>
      <span>I</span>
      Show mixin list
    </li>
    <li>
      <span>F</span>
      Show file list
    </li>
    <li>
      <span>M</span>
      Show method list
    </li>
    <li>
      <span>E</span>
      Show extras list
    </li>
  </ul>
  <p>
    You can focus and blur the search input:
  </p>
  <ul>
    <li>
      <span>S</span>
      Focus search input
    </li>
    <li>
      <span>Esc</span>
      Blur search input
    </li>
  </ul>
</div>
  </body>
</html>